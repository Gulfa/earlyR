<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Early investigation of infectiousness using earlyR • earlyR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">earlyR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Early investigation of infectiousness using earlyR</h1>
                        <h4 class="author">Thibaut Jombart</h4>
            
            <h4 class="date">2017-05-30</h4>
          </div>

    
    
<div class="contents">
<p>In this example we assume a small outbreak of Ebola Virus Disease (EVD), for which the serial interval has been previously characterised. We study a fake outbreak, for which we will quantify infectiousness (R), and then project future incidence using the package <a href="https://github.com/reconhub/projections"><em>projections</em></a>.</p>
<p>The fake data we consider consist of confirmed cases with the following symptom onset dates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">onset &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">"2017-02-04"</span>, <span class="st">"2017-02-12"</span>, <span class="st">"2017-02-15"</span>,
                   <span class="st">"2017-02-23"</span>, <span class="st">"2017-03-01"</span>, <span class="st">"2017-03-01"</span>,
           <span class="st">"2017-03-02"</span>, <span class="st">"2017-03-03"</span>, <span class="st">"2017-03-03"</span>))        </code></pre></div>
<p>We compute the daily incidence using the package <a href="https://github.com/reconhub/incidence"><em>incidence</em></a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(incidence)
i &lt;-<span class="st"> </span><span class="kw">incidence</span>(onset)
i</code></pre></div>
<pre><code>## &lt;incidence object&gt;
## [9 cases from days 2017-02-04 to 2017-03-03]
## 
## $counts: matrix with 28 rows and 1 columns
## $n: 9 cases in total
## $dates: 28 dates marking the left-side of bins
## $interval: 1 day
## $timespan: 28 days</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(i, <span class="dt">border =</span> <span class="st">"white"</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/incidence-1.png" width="672"></p>
<p>Notice that the epicurve stops exactly after the last date of onset. Let us assume it is currently the 21th March, and no case has been seen since the 6th March. We need to indicate this to <code>incidence</code> using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">today &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"2017-03-21"</span>)
i &lt;-<span class="st"> </span><span class="kw">incidence</span>(onset, <span class="dt">last_date =</span> today)
i</code></pre></div>
<pre><code>## &lt;incidence object&gt;
## [9 cases from days 2017-02-04 to 2017-03-21]
## 
## $counts: matrix with 46 rows and 1 columns
## $n: 9 cases in total
## $dates: 46 dates marking the left-side of bins
## $interval: 1 day
## $timespan: 46 days</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(i, <span class="dt">border =</span> <span class="st">"white"</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/incidence2-1.png" width="672"></p>
<p>It is <strong>very important to make sure that the last days without cases are included here</strong>. Omitting this information would lead to an over-estimation of the reproduction number (<em>R</em>).</p>
<p>For estimating <em>R</em>, we need estimates of the mean and standard deviation of the serial interval, i.e. the delay between primary and secondary symptom onset dates. This has been quantified durin the West African EVD outbreak (WHO Ebola Response Team (2014) NEJM 371:1481–1495):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span><span class="fl">15.3</span> <span class="co"># mean in days days</span>
sigma &lt;-<span class="st"> </span><span class="fl">9.3</span> <span class="co"># standard deviation in days</span></code></pre></div>
<p>The function <code>get_R</code> is then used to estimate the most likely values of <em>R</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(earlyR)

res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_R.html">get_R</a></span>(i, <span class="dt">si_mean =</span> mu, <span class="dt">si_sd =</span> sigma)
res</code></pre></div>
<pre><code>## 
## /// Early estimate of reproduction number (R) //
##  // class: earlyR, list
## 
##  // Maximum-Likelihood estimate of R ($R_ml):
## [1] 1.021021
## 
## 
##  // $lambda:
##   0.01838179 0.0273192 0.03514719 0.0414835 0.04623398 0.04946402...
## 
##  // $dates:
## [1] "2017-02-05" "2017-02-06" "2017-02-07" "2017-02-08" "2017-02-09"
## [6] "2017-02-10"
## ...
## 
##  // $si (serial interval):
## A discrete distribution
##   name: gamma
##   parameters:
##     shape: 2.70655567117586
##     scale: 5.65294117647059</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(res)</code></pre></div>
<p><img src="earlyR_files/figure-html/estimate-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(res, <span class="st">"lambdas"</span>, <span class="dt">scale =</span> <span class="kw">length</span>(onset) +<span class="st"> </span><span class="dv">1</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> onset, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> today, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">points</span>(onset, <span class="kw">seq_along</span>(onset), <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/estimate-2.png" width="672"></p>
<p>The first figure shows the distribution of likely values of <em>R</em>, and the Maximum-Likelihood (ML) estimation. The second figure shows the global force of infection over time, with vertical grey bars indicating the presence of cases, and dots showing the dates of symptom of onset. The dashed blue line indicates current day.</p>
<p>Based on this figure and on the estimated <em>R</em>, we can wonder if new cases will be seen in the near future. How likely is this? We can use the package <a href="https://github.com/reconhub/projections"><em>projections</em></a> to have an idea. The function <code>project</code> can be used to simulate a large number of future epicurves which are in line with the current data, serial interval and <em>R</em>. Rather than using a single ML estimate of <em>R</em> (as we can see, there is some variability in the distribution), we use a sample of 1,000 likely <em>R</em> values using <code>sample_R</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">R_val &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_R.html">sample_R</a></span>(res, <span class="dv">1000</span>)
<span class="kw">summary</span>(R_val)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.3353  0.8646  1.0861  1.1457  1.3864  2.9680</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(R_val)</code></pre></div>
<pre><code>##        0%       25%       50%       75%      100% 
## 0.3353353 0.8646146 1.0860861 1.3863864 2.9679680</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(R_val, <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</code></pre></div>
<pre><code>##      2.5%     97.5% 
## 0.5504254 1.9569570</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(R_val, <span class="dt">border =</span> <span class="st">"grey"</span>, <span class="dt">col =</span> <span class="st">"navy"</span>,
     <span class="dt">xlab =</span> <span class="st">"Values of R"</span>,
     <span class="dt">main =</span> <span class="st">"Sample of likely R values"</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/sample_R-1.png" width="672"></p>
<p>We retrieve the serial interval (SI) from <code>res</code>: <a href="https://github.com/reconhub/distcrete"><em>distcrete</em></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">si &lt;-<span class="st"> </span>res$si
si</code></pre></div>
<pre><code>## A discrete distribution
##   name: gamma
##   parameters:
##     shape: 2.70655567117586
##     scale: 5.65294117647059</code></pre>
<p>We now use <code>project</code> to simulate future epicurves:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(projections)

future_i &lt;-<span class="st"> </span><span class="kw">project</span>(i, <span class="dt">R =</span> R_val, <span class="dt">n_sim =</span> <span class="dv">1000</span>, <span class="dt">si =</span> res$si, <span class="dt">n_days =</span> <span class="dv">30</span>)
future_i</code></pre></div>
<pre><code>## 
## /// Incidence projections //
## 
##   // class: projections, matrix
##   // 30 dates (rows); 1,000 simulations (columns)
## 
##  // first rows/columns:
##       [,1] [,2] [,3] [,4] [,5] [,6]
## 17247    0    0    0    0    0    0
## 17248    0    0    1    0    1    0
## 17249    0    1    0    0    0    0
## 17250    0    0    0    0    0    0
##  .
##  .
##  .
## 
##  // dates:
##  [1] "2017-03-22" "2017-03-23" "2017-03-24" "2017-03-25" "2017-03-26"
##  [6] "2017-03-27" "2017-03-28" "2017-03-29" "2017-03-30" "2017-03-31"
## [11] "2017-04-01" "2017-04-02" "2017-04-03" "2017-04-04" "2017-04-05"
## [16] "2017-04-06" "2017-04-07" "2017-04-08" "2017-04-09" "2017-04-10"
## [21] "2017-04-11" "2017-04-12" "2017-04-13" "2017-04-14" "2017-04-15"
## [26] "2017-04-16" "2017-04-17" "2017-04-18" "2017-04-19" "2017-04-20"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(future_i) <span class="co"># average incidence / day</span></code></pre></div>
<pre><code>## [1] 0.1599667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(future_i)</code></pre></div>
<p><img src="earlyR_files/figure-html/projections-1.png" width="672"></p>
<p>The plot shows the median (plain) and 95% credible interval of incidences. Here, this means most simulations have no new cases. This is likely due to the fact that no case have been seen for the last few days - this would not be compatible with ongoing growth of the epidemic. To have the distribution of the total number of new cases predicted in the next 30 days, we can use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predicted_n &lt;-<span class="st"> </span><span class="kw">colSums</span>(future_i)
<span class="kw">summary</span>(predicted_n)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   1.000   3.000   4.799   7.000  79.000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(predicted_n, <span class="dt">col =</span> <span class="st">"darkred"</span>, <span class="dt">border =</span> <span class="st">"white"</span>,
     <span class="dt">main =</span> <span class="st">"Prediction: new cases in 30 days"</span>,
     <span class="dt">xlab =</span> <span class="st">"Total number of new cases"</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/pred_size-1.png" width="672"></p>
<p>Note that without the recent zero incidence, results would be drastically different:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alt_i &lt;-<span class="st"> </span><span class="kw">incidence</span>(onset)
alt_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_R.html">get_R</a></span>(alt_i, <span class="dt">si_mean =</span> mu, <span class="dt">si_sd =</span> sigma)
alt_R_val &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_R.html">sample_R</a></span>(alt_res, <span class="dv">1000</span>)
alt_future_i &lt;-<span class="st"> </span><span class="kw">project</span>(alt_i, <span class="dt">R =</span> alt_R_val, <span class="dt">n_sim =</span> <span class="dv">1000</span>, <span class="dt">si =</span> res$si, <span class="dt">n_days =</span> <span class="dv">30</span>)
alt_future_i</code></pre></div>
<pre><code>## 
## /// Incidence projections //
## 
##   // class: projections, matrix
##   // 30 dates (rows); 1,000 simulations (columns)
## 
##  // first rows/columns:
##       [,1] [,2] [,3] [,4] [,5] [,6]
## 17229    1    0    0    0    0    1
## 17230    0    0    0    1    0    0
## 17231    2    0    0    0    2    0
## 17232    1    3    0    2    2    2
##  .
##  .
##  .
## 
##  // dates:
##  [1] "2017-03-04" "2017-03-05" "2017-03-06" "2017-03-07" "2017-03-08"
##  [6] "2017-03-09" "2017-03-10" "2017-03-11" "2017-03-12" "2017-03-13"
## [11] "2017-03-14" "2017-03-15" "2017-03-16" "2017-03-17" "2017-03-18"
## [16] "2017-03-19" "2017-03-20" "2017-03-21" "2017-03-22" "2017-03-23"
## [21] "2017-03-24" "2017-03-25" "2017-03-26" "2017-03-27" "2017-03-28"
## [26] "2017-03-29" "2017-03-30" "2017-03-31" "2017-04-01" "2017-04-02"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(alt_future_i)</code></pre></div>
<pre><code>## [1] 5.008467</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(alt_future_i)</code></pre></div>
<p><img src="earlyR_files/figure-html/alternative-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## alternative plot
col &lt;-<span class="st"> "#cc66991a"</span>
<span class="kw">matplot</span>(alt_future_i, <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">col =</span> col, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">5</span>,
        <span class="dt">xlab =</span> <span class="st">"Day from today"</span>,
    <span class="dt">ylab =</span> <span class="st">"Projected daily incidence"</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/alternative-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alt_predicted_n &lt;-<span class="st"> </span><span class="kw">colSums</span>(alt_future_i)
<span class="kw">summary</span>(alt_predicted_n)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     2.0    54.0   103.0   150.3   196.2  1072.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(alt_predicted_n, <span class="dt">col =</span> <span class="st">"darkred"</span>, <span class="dt">border =</span> <span class="st">"white"</span>,
     <span class="dt">main =</span> <span class="st">"Prediction: new cases in 30 days"</span>,
     <span class="dt">xlab =</span> <span class="st">"Total number of new cases"</span>)</code></pre></div>
<p><img src="earlyR_files/figure-html/alternative-3.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Anne Cori, Pierre Nouvellet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
